/*
==== Standard ====
= require jquery
= require bootstrap

==== Angular ====
= require angular

==== Angular Plugins ====
= require lodash
= require restangular
= require angular-ui-router

= require_self
= require_tree ./angular/templates
= require_tree .
*/

var APP = angular.module('<%= Rails.application.class.parent_name %>', [
  'ui.router',
  'templates',
  'restangular'
]);

APP.config(function($stateProvider, $urlRouterProvider, $locationProvider, RestangularProvider) {
  RestangularProvider.setBaseUrl("/api");

  $urlRouterProvider.otherwise("/");
  $stateProvider
    .state('index', {
      url: "/",
      templateUrl: "index.html"
    })
    .state('rooms', {
      url: "/rooms",
      templateUrl: "rooms/index.html",
      abstract: true
    })
    .state('rooms.games', {
      url: "/:room_id/games",
      templateUrl: "rooms/games.all.html",
      controller: "RoomGamesController"
    });

  $stateProvider.state('game', {
      url: "/games/:id",
      views: {
        '': {
          templateUrl: "games/game.html",
          controller: "GameController"
        },
        'left': {
          templateUrl: "games/sidebar.html",
          controller: "GameWaitingController"
        }
      }
    });

  $locationProvider.html5Mode(true);
});

APP.run(function($rootScope) {
  $rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams){
    $rootScope.sidebarLeftContent = null;
    $rootScope.sidebarRightContent = null;
    $rootScope.leftScope = null;
    $rootScope.rightScope = null;
  });
});
